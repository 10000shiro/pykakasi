
environment:
  PYPI_PASSWORD:
    secure: ibyxU09f3mAdoh5Hv4T27Q==

  matrix:
    - PYTHON: "C:\\Python27"
    - PYTHON: "C:\\Python33"
    - PYTHON: "C:\\Python34"
    - PYTHON: "C:\\Python35"
    - PYTHON: "C:\\Python36-x64"

cache:
  - '%LOCALAPPDATA%\pip\cache'

install:
  - "%PYTHON%\\python.exe -m pip install wheel"
  - "%PYTHON%\\python.exe -m pip install -U -r requirements-dev.txt -r requirements.txt"
  - "%PYTHON%\\python.exe -m pip install -U twine"

build_script: 
  - "%PYTHON%\\python.exe setup.py build"

test_script:
  - "%PYTHON%\\python.exe setup.py test"

after_test:
  - "%PYTHON%\\python.exe setup.py sdist bdist_wheel"
  - "%PYTHON%\\python.exe setup.py bdist_wininst"
  - "%PYTHON%\\python.exe setup.py bdist_msi"

artifacts:
  - path: dist\*

deploy_script:
  # borows https://github.com/AndrewAnnex/SpiceyPy/blob/master/appveyor.yml
  - echo "Starting Artifact deployment"
  - echo [distutils]               > %USERPROFILE%\\.pypirc
  - echo index-servers =          >> %USERPROFILE%\\.pypirc
  - echo   pypi                   >> %USERPROFILE%\\.pypirc
  - echo [pypi]                   >> %USERPROFILE%\\.pypirc
  - echo repository=https://pypi.python.org/pypi >> %USERPROFILE%\\.pypirc
  - echo username=miurahr         >> %USERPROFILE%\\.pypirc
  - echo password=%pypi_password% >> %USERPROFILE%\\.pypirc
  - ps: If ($env:APPVEYOR_REPO_TAG -eq "true" ) { Invoke-Expression "twine upload -r pypi --skip-existing dist/*" 2>$null } Else { write-output "Not on a tag, won't deploy to pypi"}

notifications:
  - provider: Webhook
    url: https://webhooks.gitter.im/e/527beafbc6f6f66bf889
    method: POST